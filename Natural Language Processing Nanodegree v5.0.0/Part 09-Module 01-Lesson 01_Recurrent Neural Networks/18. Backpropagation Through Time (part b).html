<!-- udacimak v1.4.4 -->
<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta content="ie=edge" http-equiv="X-UA-Compatible"/>
  <title>
   Backpropagation Through Time (part b)
  </title>
  <link href="../assets/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="../assets/css/plyr.css" rel="stylesheet"/>
  <link href="../assets/css/katex.min.css" rel="stylesheet"/>
  <link href="../assets/css/jquery.mCustomScrollbar.min.css" rel="stylesheet"/>
  <link href="../assets/css/styles.css" rel="stylesheet"/>
  <link href="../assets/img/udacimak.png" rel="shortcut icon" type="image/png">
  </link>
 </head>
 <body>
  <div class="wrapper">
   <nav id="sidebar">
    <div class="sidebar-header">
     <h3>
      Recurrent Neural Networks
     </h3>
    </div>
    <ul class="sidebar-list list-unstyled CTAs">
     <li>
      <a class="article" href="../index.html">
       Back to Home
      </a>
     </li>
    </ul>
    <ul class="sidebar-list list-unstyled components">
     <li class="">
      <a href="01. Introducing Ortal .html">
       01. Introducing Ortal
      </a>
     </li>
     <li class="">
      <a href="02. RNN Introduction.html">
       02. RNN Introduction
      </a>
     </li>
     <li class="">
      <a href="03. RNN History.html">
       03. RNN History
      </a>
     </li>
     <li class="">
      <a href="04. RNN Applications.html">
       04. RNN Applications
      </a>
     </li>
     <li class="">
      <a href="05. Feedforward Neural Network-Reminder.html">
       05. Feedforward Neural Network-Reminder
      </a>
     </li>
     <li class="">
      <a href="06. The Feedforward Process.html">
       06. The Feedforward Process
      </a>
     </li>
     <li class="">
      <a href="07. Feedforward Quiz.html">
       07. Feedforward Quiz
      </a>
     </li>
     <li class="">
      <a href="08. Backpropagation- Theory.html">
       08. Backpropagation- Theory
      </a>
     </li>
     <li class="">
      <a href="09. Backpropagation - Example (part a).html">
       09. Backpropagation - Example (part a)
      </a>
     </li>
     <li class="">
      <a href="10. Backpropagation- Example (part b).html">
       10. Backpropagation- Example (part b)
      </a>
     </li>
     <li class="">
      <a href="11. Backpropagation Quiz.html">
       11. Backpropagation Quiz
      </a>
     </li>
     <li class="">
      <a href="12.  RNN (part a).html">
       12.  RNN (part a)
      </a>
     </li>
     <li class="">
      <a href="13. RNN (part b).html">
       13. RNN (part b)
      </a>
     </li>
     <li class="">
      <a href="14. RNN-  Unfolded Model.html">
       14. RNN-  Unfolded Model
      </a>
     </li>
     <li class="">
      <a href="15. Unfolded Model Quiz.html">
       15. Unfolded Model Quiz
      </a>
     </li>
     <li class="">
      <a href="16. RNN- Example.html">
       16. RNN- Example
      </a>
     </li>
     <li class="">
      <a href="17. Backpropagation Through Time (part a).html">
       17. Backpropagation Through Time (part a)
      </a>
     </li>
     <li class="">
      <a href="18. Backpropagation Through Time (part b).html">
       18. Backpropagation Through Time (part b)
      </a>
     </li>
     <li class="">
      <a href="19. Backpropagation Through Time (part c).html">
       19. Backpropagation Through Time (part c)
      </a>
     </li>
     <li class="">
      <a href="20. BPTT Quiz 1.html">
       20. BPTT Quiz 1
      </a>
     </li>
     <li class="">
      <a href="21. BPTT Quiz 2.html">
       21. BPTT Quiz 2
      </a>
     </li>
     <li class="">
      <a href="22. BPTT Quiz 3.html">
       22. BPTT Quiz 3
      </a>
     </li>
     <li class="">
      <a href="23. Some more math.html">
       23. Some more math
      </a>
     </li>
     <li class="">
      <a href="24. RNN Summary.html">
       24. RNN Summary
      </a>
     </li>
     <li class="">
      <a href="25. From RNN to LSTM.html">
       25. From RNN to LSTM
      </a>
     </li>
     <li class="">
      <a href="26. Wrap Up.html">
       26. Wrap Up
      </a>
     </li>
    </ul>
    <ul class="sidebar-list list-unstyled CTAs">
     <li>
      <a class="article" href="../index.html">
       Back to Home
      </a>
     </li>
    </ul>
   </nav>
   <div id="content">
    <header class="container-fluild header">
     <div class="container">
      <div class="row">
       <div class="col-12">
        <div class="align-items-middle">
         <button class="btn btn-toggle-sidebar" id="sidebarCollapse" type="button">
          <div>
          </div>
          <div>
          </div>
          <div>
          </div>
         </button>
         <h1 style="display: inline-block">
          18. Backpropagation Through Time (part b)
         </h1>
        </div>
       </div>
      </div>
     </div>
    </header>
    <main class="container">
     <div class="row">
      <div class="col-12">
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <p>
          We will now unfold the model. You will see that unfolding the model in time is very helpful in visualizing the number of steps (translated into multiplication) needed in the Backpropagation Through Time  process. These multiplications stem from the chain rule and are easily visualized using this model.
         </p>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <p>
          In this video we will understand how to use Backpropagation Through Time (BPTT) when adjusting two weight matrices:
         </p>
         <ul>
          <li>
           <span class="mathquill ud-math">
            W_y
           </span>
           - the weight matrix connecting the state the output
          </li>
          <li>
           <span class="mathquill ud-math">
            W_s
           </span>
           - the weight matrix connecting one state to the next state
          </li>
         </ul>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
         <p>
          20 RNN BPTT B V5 Final
         </p>
        </h3>
        <video controls="">
         <source src="18. 20 RNN BPTT B V5 Final-bUU9BEQw0IA.mp4" type="video/mp4"/>
         <track default="false" kind="subtitles" label="zh-CN" src="18. 20 RNN BPTT B V5 Final-bUU9BEQw0IA.zh-CN.vtt" srclang="zh-CN"/>
         <track default="false" kind="subtitles" label="pt-BR" src="18. 20 RNN BPTT B V5 Final-bUU9BEQw0IA.pt-BR.vtt" srclang="pt-BR"/>
         <track default="true" kind="subtitles" label="en" src="18. 20 RNN BPTT B V5 Final-bUU9BEQw0IA.en.vtt" srclang="en"/>
        </video>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <p>
          The unfolded model can be very helpful in visualizing the BPTT process.
         </p>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <figure class="figure">
          <img alt="_The Unfolded Model at timestep 3_" class="img img-fluid" src="img/screen-shot-2017-11-27-at-1.58.01-pm.png"/>
          <figcaption class="figure-caption">
           <p>
            <em>
             The Unfolded Model at timestep 3
            </em>
           </p>
          </figcaption>
         </figure>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <p>
          <strong>
           Gradient calculations needed to adjust
           <span class="mathquill ud-math">
            W_y
           </span>
          </strong>
         </p>
         <p>
          The partial derivative of the Loss Function with respect to
          <span class="mathquill ud-math">
           W_y
          </span>
          is found by a simple one step chain rule:
          <br/>
          (Note that in this case we do not need to use BPTT. Visualization of the calculations path can be found in the video).
         </p>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <figure class="figure">
          <img alt="_Equation 36_" class="img img-fluid" src="img/screen-shot-2017-11-21-at-3.38.11-pm.png"/>
          <figcaption class="figure-caption">
           <p>
            <em>
             Equation 36
            </em>
           </p>
          </figcaption>
         </figure>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <p>
          Generally speaking, we can consider multiple timesteps back, and not only 3 as in this example. For an arbitrary timestep N, the gradient calculation needed for adjusting
          <span class="mathquill ud-math">
           W_y
          </span>
          , is:
         </p>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <figure class="figure">
          <img alt="_Equation 37_" class="img img-fluid" src="img/screen-shot-2017-11-21-at-4.21.41-pm.png"/>
          <figcaption class="figure-caption">
           <p>
            <em>
             Equation 37
            </em>
           </p>
          </figcaption>
         </figure>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <p>
          <strong>
           Gradient calculations needed to adjust
           <span class="mathquill ud-math">
            W_s
           </span>
          </strong>
         </p>
         <p>
          We still need to adjust
          <span class="mathquill ud-math">
           W_s
          </span>
          the weight matrix connecting one state to the next and
          <span class="mathquill ud-math">
           W_x
          </span>
          the weight matrix connecting the input to the state. We will arbitrarily start with
          <span class="mathquill ud-math">
           W_s
          </span>
          .
         </p>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <p>
          To understand the
          <strong>
           BPTT
          </strong>
          process, we can simplify the unfolded model. We will focus on the contributions of
          <span class="mathquill ud-math">
           W_s
          </span>
          to the output, the following way:
         </p>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <figure class="figure">
          <img alt="_Simplified Unfolded model for Adjusting Ws_" class="img img-fluid" src="img/screen-shot-2017-11-27-at-2.00.15-pm.png"/>
          <figcaption class="figure-caption">
           <p>
            <em>
             Simplified Unfolded model for Adjusting Ws
            </em>
           </p>
          </figcaption>
         </figure>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <p>
          When calculating the partial derivative of the Loss Function with respect to
          <span class="mathquill ud-math">
           W_s
          </span>
          , we need to consider all of the states contributing to the output. In the case of this example it will be states
          <span class="mathquill ud-math">
           \bar{s_3}
          </span>
          which depends on its predecessor
          <span class="mathquill ud-math">
           \bar{s_2}
          </span>
          which depends on its predecessor
          <span class="mathquill ud-math">
           \bar{s_1}
          </span>
          , the first state.
         </p>
         <p>
          In
          <strong>
           BPTT
          </strong>
          we will take into account every gradient stemming from each state,
          <strong>
           accumulating
          </strong>
          all of these contributions.
         </p>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <ul>
          <li>
           At timestep t=3, the contribution to the gradient stemming from
           <span class="mathquill ud-math">
            \bar{s_3}
           </span>
           is the following :
           <br/>
           (Notice the use of the chain rule here. If you need, go back to the video to visualize the calculation path).
          </li>
         </ul>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <figure class="figure">
          <img alt="_Equation 38_" class="img img-fluid" src="img/screen-shot-2017-11-21-at-3.42.29-pm.png"/>
          <figcaption class="figure-caption">
           <p>
            <em>
             Equation 38
            </em>
           </p>
          </figcaption>
         </figure>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <ul>
          <li>
           At timestep t=3, the contribution to the gradient stemming from
           <span class="mathquill ud-math">
            \bar{s_2}
           </span>
           is the following :
           <br/>
           (Notice how the equation, derived by the chain rule, considers the contribution of
           <span class="mathquill ud-math">
            \bar{s_2}
           </span>
           to
           <span class="mathquill ud-math">
            \bar{s_3}
           </span>
           . If you need, go back to the video to visualize the calculation path).
          </li>
         </ul>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <figure class="figure">
          <img alt="_Equation 39_" class="img img-fluid" src="img/screen-shot-2017-11-21-at-3.44.15-pm.png"/>
          <figcaption class="figure-caption">
           <p>
            <em>
             Equation 39
            </em>
           </p>
          </figcaption>
         </figure>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <ul>
          <li>
           At timestep t=3, the contribution to the gradient stemming from
           <span class="mathquill ud-math">
            \bar{s_1}
           </span>
           is the following :
           <br/>
           (Notice how the equation, derived by the chain rule, considers the contribution of
           <span class="mathquill ud-math">
            \bar{s_1}
           </span>
           to
           <span class="mathquill ud-math">
            \bar{s_2}
           </span>
           and
           <span class="mathquill ud-math">
            \bar{s_3}
           </span>
           . If you need, go back to the video to visualize the calculation path).
          </li>
         </ul>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <figure class="figure">
          <img alt="_Equation 40_" class="img img-fluid" src="img/screen-shot-2017-11-21-at-3.45.50-pm.png"/>
          <figcaption class="figure-caption">
           <p>
            <em>
             Equation 40
            </em>
           </p>
          </figcaption>
         </figure>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <p>
          After considering the contributions from all three states:
          <span class="mathquill ud-math">
           \bar{s_3}
          </span>
          ,
          <span class="mathquill ud-math">
           \bar{s_2}
          </span>
          and
          <span class="mathquill ud-math">
           \bar{s_1}
          </span>
          , we will
          <strong>
           accumulate
          </strong>
          them to find the final gradient calculation.
         </p>
         <p>
          The following equation is the gradient contributing to the adjustment of
          <span class="mathquill ud-math">
           W_s
          </span>
          using
          <strong>
           Backpropagation Through Time
          </strong>
          :
         </p>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <figure class="figure">
          <img alt="_Equation 41_" class="img img-fluid" src="img/screen-shot-2017-11-21-at-3.49.24-pm.png"/>
          <figcaption class="figure-caption">
           <p>
            <em>
             Equation 41
            </em>
           </p>
          </figcaption>
         </figure>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <p>
          In this example we had 3 time steps to consider, therefore we accumulated three partial derivative calculations. Generally speaking, we can consider multiple timesteps back. If you look closely at the three components of equation 41, you will notice a pattern. You will find that as we propagate a step back, we have an additional partial derivatives to consider in the chain rule. Mathematically this can be easily written in the following general equation for adjusting
          <span class="mathquill ud-math">
           W_s
          </span>
          using
          <strong>
           BPTT
          </strong>
          :
         </p>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <figure class="figure">
          <img alt="_Equation 42_" class="img img-fluid" src="img/screen-shot-2017-11-21-at-4.17.35-pm.png"/>
          <figcaption class="figure-caption">
           <p>
            <em>
             Equation 42
            </em>
           </p>
          </figcaption>
         </figure>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <p>
          Notice that Equation 6 considers a general setting of N steps back. As mentioned in this lesson, capturing relationships that span more than 8 to 10 steps back is practically impossible due to the vanishing gradient problem. We will talk about a solution to this problem in our LSTM section coming up soon.
         </p>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <p>
          We still need to adjust
          <span class="mathquill ud-math">
           W_x
          </span>
          , the weight matrix connecting the input to the state.
         </p>
         <p>
          Let's take a small break. You can use this time to go over the
          <strong>
           BPTT
          </strong>
          process we've seen so far. Try to get yourself comfortable with the math.
         </p>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <p>
          Once you are feeling confident with the content of the video you just viewed, try to derive the calculations for adjusting the last matrix,
          <span class="mathquill ud-math">
           W_x
          </span>
          by yourself. This is by no means a must, but if you feel that you are up for the challenge, go for it!  It will be interesting to compare your notes with ours.
         </p>
         <p>
          If you chose to take on the challenge, focus on simplifying the unfolded model, leaving only what you need for the calculations. Sketch the backpropagation "path", and step by step think of how the chain rule helps with the derivations here. Don't forget to** accumulate!**.
         </p>
        </div>
       </div>
       <div class="divider">
       </div>
      </div>
      <div class="col-12">
       <p class="text-right">
        <a class="btn btn-outline-primary mt-4" href="19. Backpropagation Through Time (part c).html" role="button">
         Next Concept
        </a>
       </p>
      </div>
     </div>
    </main>
    <footer class="footer">
     <div class="container">
      <div class="row">
       <div class="col-12">
        <p class="text-center">
         udacity2.0 If you need the newest courses Plase add me wechat: udacity6
        </p>
       </div>
      </div>
     </div>
    </footer>
   </div>
  </div>
  <script src="../assets/js/jquery-3.3.1.min.js">
  </script>
  <script src="../assets/js/plyr.polyfilled.min.js">
  </script>
  <script src="../assets/js/bootstrap.min.js">
  </script>
  <script src="../assets/js/jquery.mCustomScrollbar.concat.min.js">
  </script>
  <script src="../assets/js/katex.min.js">
  </script>
  <script>
   // Initialize Plyr video players
    const players = Array.from(document.querySelectorAll('video')).map(p => new Plyr(p));

    // render math equations
    let elMath = document.getElementsByClassName('mathquill');
    for (let i = 0, len = elMath.length; i < len; i += 1) {
      const el = elMath[i];

      katex.render(el.textContent, el, {
        throwOnError: false
      });
    }

    // this hack will make sure Bootstrap tabs work when using Handlebars
    if ($('#question-tabs').length && $('#user-answer-tabs').length) {
      $("#question-tabs a.nav-link").on('click', function () {
        $("#question-tab-contents .tab-pane").hide();
        $($(this).attr("href")).show();
      });
      $("#user-answer-tabs a.nav-link").on('click', function () {
        $("#user-answer-tab-contents .tab-pane").hide();
        $($(this).attr("href")).show();
      });
    } else {
      $("a.nav-link").on('click', function () {
        $(".tab-pane").hide();
        $($(this).attr("href")).show();
      });
    }

    // side bar events
    $(document).ready(function () {
      $("#sidebar").mCustomScrollbar({
        theme: "minimal"
      });

      $('#sidebarCollapse').on('click', function () {
        $('#sidebar, #content').toggleClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
      });

      // scroll to first video on page loading
      if ($('video').length) {
        $('html,body').animate({ scrollTop: $('div.plyr').prev().offset().top});
      }

      // auto play first video: this may not work with chrome/safari due to autoplay policy
      if (players && players.length > 0) {
        players[0].play();
      }

      // scroll sidebar to current concept
      const currentInSideBar = $( "ul.sidebar-list.components li a:contains('18. Backpropagation Through Time (part b)')" )
      currentInSideBar.css( "text-decoration", "underline" );
      $("#sidebar").mCustomScrollbar('scrollTo', currentInSideBar);
    });
  </script>
 </body>
</html>
